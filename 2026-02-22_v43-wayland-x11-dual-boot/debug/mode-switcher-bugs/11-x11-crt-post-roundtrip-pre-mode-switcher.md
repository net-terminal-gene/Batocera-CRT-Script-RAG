# X11 CRT Post-Roundtrip Pre-Mode-Switcher — 2026-02-22 00:37 UTC

**Context:** After HD→CRT reboot. This is the critical test — first CRT boot after a full CRT→HD→CRT roundtrip. Checking state before launching any CRT tool.

## System State

| Field | Value |
|---|---|
| Uptime | 1 min |
| Kernel | 6.18.9 |
| BOOT_IMAGE | `/crt/linux` (X11 CRT kernel) |
| cmdline | `drm.edid_firmware=DP-1:edid/ms929.bin video=DP-1:e` |
| Syslinux DEFAULT | `crt` |

## Display

```
Screen 0: current 769 x 576
DP-1 connected primary 769x576+0+0
   769x576i      50.00*+
```

Display is active and at correct CRT resolution.

## 15-crt-monitor.conf

Present: `-rw-r--r-- 333 bytes` — generated by CRT overlay on boot.

## batocera-resolution currentMode

```
Without DISPLAY:  (empty — "Can't open display" on stderr)
With DISPLAY=:0.0: 769x576.50.00
```

**Finding:** `batocera-resolution currentMode` requires `DISPLAY=:0.0` on X11. SSH sessions don't have it set. EmulationStation-launched commands inherit DISPLAY from ES, so `crt-launcher.sh` should work in practice. But the wrapper does NOT explicitly set `DISPLAY=:0.0` — it relies on inheritance.

## batocera.conf

```
global.videomode=769x576.50.00
global.videooutput=DP-1
global.videooutput2=none
es.resolution=769x576.50.00
CRT.emulator=sh
CRT.core=sh
```

`global.videomode=769x576.50.00` matches `currentMode` output (`769x576.50.00`). **No mismatch.**

## es_systems_crt.cfg

```xml
<command>/userdata/system/Batocera-CRT-Script/Geometry_modeline/crt-launcher.sh ...</command>
```

Correctly points to `crt-launcher.sh`.

## crt-launcher.sh

Present and executable. Does NOT explicitly set `DISPLAY` — relies on ES inheritance.

## boot-custom.sh

**Not found** at `/userdata/system/scripts/boot-custom.sh`. Was removed during CRT restore. The `15-crt-monitor.conf` was generated from the CRT overlay, not from `boot-custom.sh`.

## CRT Tools in /userdata/roms/crt/

All present: `es_adjust_tool.sh`, `geometry.sh`, `grid_tool.sh`, `mode_switcher.sh`, `overlays_overrides.sh`, `GunCon2_Calibration.sh`

## Prediction

Since `global.videomode` (769x576.50.00) already matches `currentMode` (769x576.50.00):
- `crt-launcher.sh` sync is a no-op (values already match)
- `emulatorlauncher` should see no mismatch → no `changeMode()` → stable display
- CRT tools should display on the physical CRT

## New Finding to Fix Later

`crt-launcher.sh` should explicitly export `DISPLAY=:0.0` before calling `batocera-resolution currentMode`, as a safety measure. Currently relies on ES providing it via environment inheritance.
