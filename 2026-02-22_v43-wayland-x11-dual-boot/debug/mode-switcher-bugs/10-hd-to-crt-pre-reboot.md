# HD→CRT Pre-Reboot State — 2026-02-22 00:34 UTC

**Context:** After completing Mode Switcher from Wayland HD to switch to CRT. User was asked to re-pick boot resolution (see bug #09). System is ready for power cycle into CRT.

## System State

| Field | Value |
|---|---|
| Uptime | 7 min |
| Kernel | 6.18.9 |
| BOOT_IMAGE | `/boot/linux` (Wayland — still running from current boot) |
| Syslinux DEFAULT | `crt` (set for next boot) |

## batocera.conf (restored from CRT backup)

```
global.videomode=769x576.50.00
global.videooutput=DP-1
global.videooutput2=none
es.resolution=769x576.50.00
CRT.emulator=sh
CRT.core=sh
```

**Key observation:** `global.videomode=769x576.50.00` — correct precision, matching `currentMode` output. This is the value the Layer 2 fix preserved from the earlier CRT→HD backup.

## CRT Mode Backup (preserved)

```
video_mode.txt:   global.videomode=769x576.50.00
video_output.txt: global.videooutput=DP-1
```

## HD Mode Backup (newly created)

```
video_mode.txt:   (empty — not saved)
video_output.txt: global.videooutput=eDP-1
```

## es_systems_crt.cfg

```xml
<command>/userdata/system/Batocera-CRT-Script/Geometry_modeline/crt-launcher.sh %CONTROLLERSCONFIG% ...</command>
```

Correctly points to `crt-launcher.sh`.

## crt-launcher.sh

Present and executable: `-rwxr-xr-x 1229 bytes`

## 15-crt-monitor.conf

**Not present** — expected. Will be generated by `boot-custom.sh` on next CRT boot.

## CRT Overlay

Present: `/boot/crt/overlay` (100MB)

## Mode Switcher Log — HD→CRT Restore

```
[00:34:07]: Preserving existing CRT video_mode.txt from prior backup
[00:34:07]: Mode switch UI completed successfully
[00:34:13]: Restored batocera.conf from CRT Mode backup
[00:34:13]: Set DEFAULT=crt in all 3 syslinux.cfg files
[00:34:13]: Set es.resolution=769x576.50.00 in both config files
[00:34:13]: Restore completed for crt mode (userdata-only approach)
```

## Known False Positives in Log

```
[00:34:13]: ERROR: es_systems_crt.cfg missing emulatorlauncher - RE-COPYING...
[00:27:07]: FINAL VERIFICATION FAILED: es_systems_crt.cfg is INCORRECT!
```

Both caused by grep checking for literal "emulatorlauncher" when the command now uses `crt-launcher.sh`. The file content is correct — re-copy is from the same source (which has `crt-launcher.sh`), so it's harmless.

## Prediction for Next CRT Boot

1. Syslinux boots `crt` label → X11 kernel + CRT overlay
2. `boot-custom.sh` generates `15-crt-monitor.conf`
3. `batocera-resolution currentMode` should report `769x576.50.00`
4. `global.videomode` already equals `769x576.50.00` — **no mismatch**
5. `emulatorlauncher` should skip `changeMode()` → **display should be stable**
6. `crt-launcher.sh` wrapper adds extra safety by syncing before launch

This is the critical roundtrip test. If CRT tools display correctly on the physical CRT after this reboot, the core bug is fixed.
